<app-header></app-header>

<div class="row" style="margin-top: 60px">
  <div class="col-md-3" style="margin-top: 60px">
    <div
      class="card text-center mt-2 mb-2 ml-2"
      style="width: 18rem; height: 10rem"
    >
      <div class="card-body mt-5">
        <p class="card-title fs-1">{{resolvedComplaints}}</p>
        <p class="card-text">Resolved Complaints</p>
      </div>
    </div>
  </div>

  <div class="col-md-3" style="margin-top: 60px">
    <div
      class="card text-center mt-2 mb-2 ml-2"
      style="width: 18rem; height: 10rem; box-shadow: inset"
    >
      <div class="card-body mt-5">
        <p class="card-title fs-1">{{unresolvedComplaints}}</p>
        <p class="card-text">Unresolved Complaints</p>
      </div>
    </div>
  </div>

  <div class="col-md-3 " style="margin-top: 60px">
    <div
      class="card text-center mt-2 mb-2 ml-2"
      style="width: 18rem; height: 10rem; box-shadow: inset"
    >
      <div class="card-body mt-5">
        <p class="card-title fs-1">{{escalatedComplaints}}</p>
        <p class="card-text">Escalated Complaints</p>
      </div>
    </div>
  </div>

  <div class="col-md-3" style="margin-top: 60px">
    <img
      src="../../../../assets/images/complaints.jpeg"
      width="200px"
      height="200px"
      style="opacity: 0.8"
      alt=""
      srcset=""
    />
  </div>
</div>

<div class="row mb-12" style="margin-left: 30px; margin-right: 30px">
  <div class="panel panel-primary filterable">
    <div class="col-md-12">
      <div class="alert alert-primary" role="alert">
        <div class="col-md-12">
          <input
            class="form-control form-control-lg"
            type="text"
            [(ngModel)]="searchText"
            (ngModelChange)="filterComplaints()"
            placeholder="Search with complaint ID , User Name or User ID"
            aria-label=".form-control-lg example"
          />
        </div>
      </div>

      <table class="table table-hover">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Complaint ID</th>
            <th scope="col">Owner ID</th>
            <th scope="col">Owner Name</th>
            <th scope="col">Description</th>
            <th scope="col">
              Status 
              
              <span class="badge bg-secondary"></span>
              <svg
                style="cursor: pointer"
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="currentColor"
                class="bi bi-filter"
                viewBox="0 0 16 16"
              >
                <path
                  d="M6 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"
                />
              </svg>



            </th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let eachRow of complaintTableData; let i = index">
            <th scope="row">{{ i + 1 }}</th>
            <td>{{ eachRow.complaintID }}</td>
            <td>{{ eachRow.userID }}</td>
            <td>{{ eachRow.userName }}</td>
            <td>{{ eachRow.complaintDesc }}</td>
            <td>
              <select
                [(ngModel)]="eachRow.status"
                class="form-select form-select-sm mb-3"
                aria-label=".form-select-lg example"

                (ngModelChange)="saveRecords(eachRow)"
              >
                <option value="UNRS">Unresolved</option>
                <option value="RS">Resolved</option>
                <option value="ESC">Esclated</option>
              </select>
            </td>

            <td>
              <div class="dropup">
                <button class="dropbtn">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    fill="currentColor"
                    class="bi bi-box-arrow-in-up-right"
                    viewBox="0 0 16 16"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M6.364 13.5a.5.5 0 0 0 .5.5H13.5a1.5 1.5 0 0 0 1.5-1.5v-10A1.5 1.5 0 0 0 13.5 1h-10A1.5 1.5 0 0 0 2 2.5v6.636a.5.5 0 1 0 1 0V2.5a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v10a.5.5 0 0 1-.5.5H6.864a.5.5 0 0 0-.5.5z"
                    />
                    <path
                      fill-rule="evenodd"
                      d="M11 5.5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793l-8.147 8.146a.5.5 0 0 0 .708.708L10 6.707V10.5a.5.5 0 0 0 1 0v-5z"
                    />
                  </svg>
                </button>
                <div class="dropup-content">
                  <a (click)="initiateRefund(eachRow)">Initiate Refund</a>
                  <a data-bs-toggle="modal" data-bs-target="#exampleModal" (click)="sendMessage(eachRow,'inApp')" href="#">Send Message</a>
                  <a data-bs-toggle="modal" data-bs-target="#exampleModal" (click)="sendMessage(eachRow,'mail')" href="#">Notify via Email</a>
                </div>
              </div>
            </td>
          </tr>

         
        </tbody>

       
      </table>

      <div *ngIf="complaintTableData.length===0">
        <h5 class="mb-6 mt-10 text-muted" style="text-align: center;">No Results found</h5>
      </div>
    </div>

   

    <button (click)="downloadExcel()" style="width:50px" *ngIf="complaintTableData.length>0" style="margin-left:90%; margin-top:10px;margin-bottom:10px;" type="button" class="btn btn-success">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-spreadsheet-fill" viewBox="0 0 16 16">
        <path d="M12 0H4a2 2 0 0 0-2 2v4h12V2a2 2 0 0 0-2-2zm2 7h-4v2h4V7zm0 3h-4v2h4v-2zm0 3h-4v3h2a2 2 0 0 0 2-2v-1zm-5 3v-3H6v3h3zm-4 0v-3H2v1a2 2 0 0 0 2 2h1zm-3-4h3v-2H2v2zm0-3h3V7H2v2zm4 0V7h3v2H6zm0 1h3v2H6v-2z"/>
      </svg>
      Download Excel</button>
  </div>

 
</div>
<app-footer></app-footer>


<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">New message</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="recipient-name" class="col-form-label">Recipient:</label>
            <input type="text" name="recipient" [value]="recipient" class="form-control" id="recipient-name">
          </div>
          <div class="mb-3">
            <label for="message-text" class="col-form-label">Message:</label>
            <textarea class="form-control" id="message-text"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" *ngIf="!sendMail" data-bs-dismiss="modal" (click)="sendMessage('inAPP')" class="btn btn-primary">Send message</button>
        <button type="button" *ngIf="sendMail" data-bs-dismiss="modal" (click)="sendMessage('mail')" class="btn btn-primary">Send Email</button>
        
      </div>
    </div>
  </div>
</div>

<table [hidden]="true" id="excel-table">
  <tr>
    <th>Id</th>
    <th>Complaint ID</th>
    <th>Complaint Description</th>
    <th>User ID</th>
    <th>User Name</th>
    <th>Status</th>
  </tr>
  <tr *ngFor="let item of complaintTableData">

    <td>{{item.id}}</td>
    <td>{{item.complaintID}}</td>
    <td>{{item.complaintDesc}}</td>
    <td>{{item.userID}}</td>
    <td>{{item.userName}}</td>
    <td>{{item.status}}</td>
  
   
  </tr>
</table>

